{"version":3,"sources":["node_modules/browser-pack/_prelude.js","es6/DeviceManager.es6","es6/app.es6","es6/controller/connect.es6","es6/controller/disconnect.es6","es6/controller/notification.es6","es6/controller/readValue.es6","es6/controller/saveValue.es6","es6/util.es6"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_util","DeviceManager","_classCallCheck","this","connecting","name","device","service","characteristics","characteristic","_this","_connect3","default","then","res","catch","error","_disconnect3","_readValue3","value","_saveValue3","_notification3","_error","err","connect","id","$","hide","show","disconnect","customDevice","_DeviceManager2","batteryDevice","heartRateDevice","log","click","val","readValue","saveValue","notification","notifyCustomDevice","writeCustomDevice","characteristicNotify","characteristicWrite","arguments","undefined","DEF_SERVICE","DEF_CHARACTERISTIC","Promise","resolve","reject","_name","_device","_characteristics","_service","navigator","bluetooth","requestDevice","filters","services","JSON","stringify","gatt","server","getPrimaryService","getCharacteristic","handleNotifications","event","target","byteLength","push","getUint8","toString","slice","join","startNotifications","_","addEventListener","v","Uint8Array","writeValue","_len","text","Array","_key","prepend","console","_len2","_key2"],"mappings":"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","file":"main.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import {log, err} from \"./util.es6\";\nimport _connect from \"./controller/connect.es6\";\nimport _disconnect from \"./controller/disconnect.es6\";\nimport _readValue from \"./controller/readValue.es6\";\nimport _saveValue from \"./controller/saveValue.es6\";\nimport _notification from \"./controller/notification.es6\";\n\nexport default class DeviceManager {\n\n    constructor() {\n        // デバイス状態（接続中：true）\n        this.connecting = false;\n        // デバイス情報\n        this.name = null;\n        // デバイス情報\n        this.device = null;\n        // サービス\n        this.service = null;\n        // Characteristics\n        this.characteristics = null;\n    }\n\n    connect(service, characteristic) {\n        this.connecting = false;\n        return _connect(service, characteristic)\n        .then((res) => {\n            this.connecting = true;\n            this.name = res.name\n            this.device = res.device;\n            this.service = res.service;\n            this.characteristics = res.characteristics;\n        })\n        .catch(this.error);\n    }\n\n    disconnect() {\n        return _disconnect(this.device)\n        .catch(this.error);\n    }\n\n    readValue() {\n        return _readValue(this.characteristics)\n        .catch(this.error);\n    }\n\n    saveValue(value) {\n        return _saveValue(this.characteristics, value)\n        .catch(this.error);\n    }\n\n    notification(){\n        return _notification(this.characteristics)\n        .catch(this.error);\n    }\n\n    error(error) {\n        err(error);\n        throw \"ERROR\"\n    }\n}","import {log, err} from \"./util.es6\";\nimport DeviceManager from \"./DeviceManager.es6\";\n\nconst customDevice = new DeviceManager();\nconst batteryDevice = new DeviceManager();\nconst heartRateDevice = new DeviceManager();\n\nconst BATTERY = 'battery_service';\nconst BATTERY_CON = 'battery_level';\nconst HEART_RATE = 'heart_rate';\nconst HEART_RATE_CON = 'heart_rate_control_point';\n\n// セットアップ処理\n(()=> {\n  log(\"start.\");\n  //window.ArrayBuffer ? alert(\"ArrayBuffer OK!\") : alert(\"ArrayBuffer NG!\");\n})();\n\n/** ボタンクリックトリガー (debug.html) */\n$('#custom_connect').click(() => {\n  const service = $('#input_service').val();\n  const characteristic = $(\"#input_characteristic\").val();\n  log(\"service=\" + service, \"characteristic=\" + characteristic);\n  customDevice.connect(service, characteristic)\n  .then(() => connect(\"#custom_connect\"));\n});\n$('#custom_disconnect').click(() => {\n  customDevice.disconnect()\n  .then(() => disconnect(\"#custom_connect\"));\n});\n$('#custom_read').click(() => {\n  customDevice.readValue();\n});\n$('#custom_save').click(() => {\n  customDevice.saveValue();\n});\n$('#custom_notification').click(() => {\n  customDevice.notification();\n});\n\n$('#battery_connect').click(() => {\n  batteryDevice.connect(BATTERY, BATTERY_CON)\n  .then(() => connect(\"#battery_connect\"));\n});\n$('#battery_disconnect').click(() => {\n  batteryDevice.disconnect()\n  .then(() => disconnect(\"#battery_connect\"));\n});\n$('#battery_read').click(() => {\n  batteryDevice.readValue();\n});\n$('#battery_save').click(() => {\n  batteryDevice.saveValue();\n});\n$('#battery_notification').click(() => {\n  batteryDevice.notification();\n});\n\n$('#heart_rate_connect').click(() => {\n  heartRateDevice.connect(HEART_RATE, HEART_RATE_CON)\n  .then(() => {\n    $(\"#heart_rate_connect\").hide();\n    $(\"#heart_rate_connect_menu\").show();\n  })\n});\n$('#heart_rate_disconnect').click(() => {\n  batteryDevice.disconnect()\n  .then(() => {\n    $(\"#heart_rate_connect\").show();\n    $(\"#heart_rate_connect_menu\").hide();\n  })\n});\n$('#heart_rate_read').click(() => {\n  heartRateDevice.readValue()\n});\n$('#heart_rate_save').click(() =>{\n  heartRateDevice.saveValue()\n});\n$('#heart_rate_notification').click(() => {\n  heartRateDevice.notification()\n});\n\n/** ボタンクリックトリガー (index.html) */\nconst notifyCustomDevice = new DeviceManager();\nconst writeCustomDevice = new DeviceManager();\n$('#BLESerial_connect').click(() => {\n  const service = $('#input_service').val();\n  const characteristicNotify = $(\"#input_characteristic_notify\").val();\n  const characteristicWrite = $(\"#input_characteristic_write\").val();\n  log(\"service=\" + service)\n  log(\"characteristicNotify=\" + characteristicNotify)\n  log(\"characteristicWrite=\" + characteristicWrite)\n  notifyCustomDevice.connect(service, characteristicNotify)\n  .then(() => writeCustomDevice.connect(service, characteristicWrite))\n  .then(() => connect(\"#BLESerial_connect\"))\n  .catch(() => disconnect(\"#BLESerial_connect\"))\n});\n$('#BLESerial_disconnect').click(() => {\n  notifyCustomDevice.disconnect()\n  .then(() => writeCustomDevice.disconnect())\n  .then(() => disconnect(\"#BLESerial_connect\"));\n});\n$('#BLESerial_read').click(() => {\n  notifyCustomDevice.readValue()\n});\n$('#BLESerial_save').click(() => {\n  const value = \"1\"\n  notifyCustomDevice.saveValue(value)\n});\n$('#BLESerial_notification').click(() => {\n  notifyCustomDevice.notification()\n});\n\n/** 接続更新アクション */\nfunction connect(id) {\n  $(id).hide();\n  $(id + \"_menu\").show();\n}\n\nfunction disconnect(id) {\n  $(id).show();\n  $(id + \"_menu\").hide();\n}","import {log, err} from \"../util.es6\";\n\nconst DEF_SERVICE = 'battery_service';\nconst DEF_CHARACTERISTIC = 'battery_level';\n\nconst anyDevice = () => {\n  return Array.from('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ')\n      .map(c => ({namePrefix: c}))\n      .concat({name: ''});\n}\n\n/** \n * デバイスリンキング開始\n */\nexport default function connect(service = DEF_SERVICE, characteristic = DEF_CHARACTERISTIC) {\n  return new Promise((resolve, reject) => {\n    log(\"clickFunc called.\");\n\n    let _name;\n    let _device;\n    let _characteristics;\n    let _service;\n\n    // デバイスのスキャン\n    log(\"scanning device.\");\n    navigator.bluetooth.requestDevice({filters: [{services: [service]}]})\n    // navigator.bluetooth.requestDevice({filters: anyDevice()})\n\n    // デバイス見つかったので、接続する\n    .then(device => {\n      _device = device;\n      _name = device.name;\n      log(\"start connecting device. \", JSON.stringify(device));\n      return device.gatt.connect();\n    })\n\n    // デバイスに接続できたので、そのデバイスのServiceを調べる\n    .then(server => {\n      log(\"checking sevice. \", JSON.stringify(server));\n      return server.getPrimaryService(service);\n    })\n\n    // Serviceを全部調べたので、次はサービスに紐づくCharacteristicsを調べる\n    .then(service => {\n      log(\"checking characteristics. \", service);\n      _service = service;\n      return service.getCharacteristic(characteristic);\n    })\n\n    // characteristicsを発見したので、characteristicsの中身を見に行く\n    .then(characteristics => {\n      log(\"discovered characteristics. \", characteristics);\n      _characteristics = characteristics\n    })\n\n    // 全て成功したのでPromiseを完了状態にする\n    .then(() => {\n      resolve({\n        name: _name,\n        device: _device,\n        service: _service,\n        characteristics: _characteristics\n      });\n    })\n\n    // エラー\n    .catch(error => {\n      reject(error);\n    });\n\n  });\n}","import {log, err} from \"../util.es6\";\n\n/**\n * デバイスリンキング解除\n */\nexport default function disconnect(_device) {\n  return new Promise((resolve) => {\n    log(\"disconnect. \");\n    _device ? _device.gatt.disconnect() : null;\n    resolve();\n  });\n}","import {log, err} from \"../util.es6\";\n\n/**\n * value取得\n */\nexport default function notification(_characteristics) {\n    return new Promise((resolve) => {\n        _characteristics.startNotifications().then(_ => {\n            _characteristics.addEventListener(\n                'characteristicvaluechanged',\n                handleNotifications\n            );\n        });\n  });\n}\n\nfunction handleNotifications(event) {\n    let value = event.target.value;\n    let a = [];\n    for (let i = 0; i < value.byteLength; i++) {\n        a.push('0x' + ('00' + value.getUint8(i).toString(16)).slice(-2));\n    }\n    log('> ' + a.join(' '));\n}","import {log, err} from \"../util.es6\";\n\n/**\n * value取得\n */\nexport default function readValue(_characteristics) {\n  return new Promise((resolve) => {\n    log(\"read.\");\n    _characteristics.readValue()\n    .then(value => {\n      log(\"read data. \", value.getUint8(0));\n      resolve();\n    })\n  });\n}","import {log, err} from \"../util.es6\";\n\n/**\n * value取得\n */\nexport default function saveValue(_characteristics, value = [1]) {\n  return new Promise((resolve) => {\n    log(\"save.\");\n    let v = new Uint8Array(value);\n    _characteristics.writeValue(v)\n    .then(res => {\n      log(\"save data. \");\n      resolve();\n    })\n  });\n}\n","/** ログ出力用Function */\nexport function log(...text) {\n  $('#log').prepend(\"<span class='debug'>\" + text + \"</span><br />\");\n  console.log(JSON.stringify(text));\n}\n\n/** ログ出力用Function */\nexport function err(...text) {\n  $('#log').prepend(\"<span class='error'>\" + text + \"</span><br />\");\n  console.log(JSON.stringify(text));\n}\n"]}